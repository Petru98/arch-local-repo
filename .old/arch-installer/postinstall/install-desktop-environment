configure_xinitrc() {
    sed -i "s/^exec .*/exec $*/" /etc/X11/xinit/xinitrc
}


install_cinnamon() {
    print_info "https://wiki.archlinux.org/index.php/Cinnamon"
    package_install cinnamon nemo-fileroller nemo-preview
    package_install gedit ghex eog evolution seahorse gnome-screenshot gnome-terminal gnome-control-center gnome-system-monitor gnome-power-manager gnome-clocks gnome-calculator gnome-disk-utility simple-scan gucharmap gnome-font-viewer
    package_install network-manager-applet materia-gtk-theme redshift
    package_install --asdeps gedit-plugins blueberry gnome-keyring

    systemctl enable --user --global redshift-gtk.service
    # https://bbs.archlinux.org/viewtopic.php?id=185123
    aur_package_install mintlocale
    configure_xinitrc cinnamon-session
}

install_kde() {
    print_info "https://wiki.archlinux.org/index.php/KDE"
    package_install plasma-meta kde-accessibility-meta ktouch # kde-pim-meta # kleopatra|kgpg
    package_install gwenview kcolorchooser kdegraphics-mobipocket kdegraphics-thumbnailers kgraphviewer kipi-plugins okular spectacle svgpart ffmpegthumbs kamoso kmix
    package_install kdeconnect kdenetwork-filesharing kio-extras zeroconf-ioslave dolphin dolphin-plugins kcachegrind kdiff3 ksystemlog
    package_install ark kate kcalc ktimer kcharselect kdialog kfind konsole krename okteta print-manager skanlite yakuake # filelight|KDiskFree? krusader? skrooge|kmymoney? partitionmanager?
    package_install --asdeps packagekit-qt5

    configure_xinitrc startkde
}


install_gdm() {
    package_install gdm
    systemctl enable gdm
}

install_lightdm() {
    package_install lightdm $(! bool $KDE && echo -n lightdm-gtk-greeter-settings)
    systemctl enable lightdm
}

install_sddm() {
    package_install sddm sddm-kcm
    systemctl enable sddm
    sddm --example-config > /etc/sddm.conf
    sed -i 's/Current=/Current=breeze/' /etc/sddm.conf
    sed -i 's/CursorTheme=/CursorTheme=breeze_cursors/' /etc/sddm.conf
    sed -i 's/Numlock=none/Numlock=on/' /etc/sddm.conf
}

install_slim() {
    package_install slim
    systemctl enable slim
}

install_lxdm() {
    package_install lxdm
    systemctl enable lxdm
}

install_lxdm-gtk3() {
    package_install lxdm-gtk3
    systemctl enable lxdm
}


[ -n "$DESKTOPENV" ] && install_$DESKTOPENV
[ -n "$DISPLAYMAN" ] && install_$DISPLAYMAN

if [[ "$DISPLAYMAN" == "" && "$DESKTOPENV" != "" ]]; then
    print_warning "You probably want to add the following to /home/$USERNAME/.profile"
    echo '[ -z "$DISPLAY" ] && [ $(tty) == /dev/tty1 ] && exec startx'
    if ! bool $KDE ; then
        print_warning "You probably want to add the following to /etc/pam.d/login"
        echo 'auth       optional     pam_gnome_keyring.so'
        echo 'session    optional     pam_gnome_keyring.so auto_start'
    fi
fi


if ! bool $KDE ; then
    package_install \
        transmission-gtk pavucontrol \
        gvfs gvfs-afc gvfs-mtp gvfs-goa gvfs-google gvfs-nfs gvfs-smb gvfs-nfs
else
    package_install transmission-qt
fi

package_install \
    gvfs-mtp xdg-user-dirs dconf-editor archlinux-wallpaper \
    gparted vlc hexchat
package_install --asdeps system-config-printer transmission-cli

# speed up application startup
mkdir -p $HOME/.compose-cache /home/$USERNAME/.compose-cache
# D-Bus interface for user account query and manipulation
systemctl enable accounts-daemon
# https://unix.stackexchange.com/questions/13751/kernel-inotify-watch-limit-reached
add_line "fs.inotify.max_user_watches = 524288" "/etc/sysctl.d/99-sysctl.conf"
